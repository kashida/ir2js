::CodeScope
  @context\!Context\$
  @head\section.Head\? new section.Global()

:process_lines
  lines\A.<s>\$
  i := 0
  @.process(lines.map(##))
    line\s\$
    => new InputLine(line, i++)

:process
  input_lines\A.<InputLine>\$
  new CodeParser(@context, @head).parse(input_lines)
  @head.transform()

:output
  => arr_flatten(@head.output()).map(##)
    line\s\$
    => line.replace(/\s*$/, '')
