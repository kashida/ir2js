::TokenListBuilder
  @parsed\%.TokenList|Array|s\$
  @input\!A.<InputLine>\$
  @tokens\%.TokenList\ new %.TokenList()

:build\%.Result\
  @build_rec(@parsed)
  => new %.Result(@tokens, @input)

:@build_rec
  data\%.TokenList|Array|s\$
  if (data instanceof %.TokenList)
    @add_tokens(data)
    =>

  if (data instanceof Array)
    @add_array(data)
    =>

  // Must be a string.
  @tokens.add(data)

:@add_tokens
  data\%.TokenList\$
  if (data instanceof %.ParamLine)
    t := @tokens
    @tokens = new %.ParamLine(#)
      data.name
      data.is_member
      data.access
      data.type
      data.marker
      data.init
    @tokens.add(t)
  else if (data instanceof %.SeparatorLine)
    t := @tokens
    @tokens = new %.SeparatorLine()
    t.add(t)
    t.add(data)
  else
    @tokens.add(data)

:@add_array
  data\Array\$
  data.forEach(##)
    elem\%.TokenList|Array|s\$
    @build_rec(elem)
